<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nexus — One prompt. Best model. Instantly.</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}

:root{
  --bg:#0a0a0a;
  --surface:#141414;
  --surface2:#1e1e1e;
  --border:rgba(255,255,255,.06);
  --border-h:rgba(255,255,255,.1);
  --t1:#ececec;
  --t2:#888;
  --t3:#555;
  --claude:#c4956a;
  --gpt:#6bc49f;
  --gemini:#7b93d4;
  --accent:#ececec;
  --radius:12px;
}

html,body{height:100%;font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--t1);overflow:hidden;-webkit-font-smoothing:antialiased}

/* ---- LAYOUT ---- */
.app{display:flex;height:100vh}
.sidebar{width:260px;min-width:260px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:20;transition:transform .3s ease}
.main{flex:1;display:flex;flex-direction:column;min-width:0;position:relative;background:var(--bg)}

/* ---- SIDEBAR ---- */
.sb-head{padding:20px 18px 14px;display:flex;align-items:center;justify-content:space-between}
.sb-logo{display:flex;align-items:center;gap:10px}
.sb-mark{width:28px;height:28px;border-radius:8px;background:var(--surface2);border:1px solid var(--border);display:grid;place-items:center}
.sb-mark svg{width:14px;height:14px;color:var(--t2)}
.sb-wordmark{font-size:15px;font-weight:600;letter-spacing:-.03em;color:var(--t1)}
.btn-new{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--t2);cursor:pointer;display:grid;place-items:center;transition:all .15s}
.btn-new:hover{border-color:var(--border-h);color:var(--t1);background:var(--surface2)}
.btn-new svg{width:16px;height:16px}

.sb-list{flex:1;overflow-y:auto;padding:4px 8px}
.sb-list::-webkit-scrollbar{width:3px}
.sb-list::-webkit-scrollbar-thumb{background:var(--t3);border-radius:2px}
.sb-label{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.08em;color:var(--t3);padding:14px 10px 6px}
.sb-item{padding:9px 12px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:background .1s;margin-bottom:1px;position:relative}
.sb-item:hover{background:var(--surface2)}
.sb-item.active{background:var(--surface2)}
.sb-item .dot{display:none}
.sb-item .title{font-size:13px;color:var(--t2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
.sb-item.active .title{color:var(--t1)}
.sb-item .del{opacity:0;border:none;background:none;color:var(--t3);cursor:pointer;padding:2px;border-radius:4px;display:grid;place-items:center;transition:all .12s}
.sb-item:hover .del{opacity:1}
.sb-item .del:hover{color:#f87171}
.sb-item .del svg{width:12px;height:12px}
.sb-empty{text-align:center;color:var(--t3);font-size:12px;padding:20px 10px}

.sb-foot{padding:14px 18px;border-top:1px solid var(--border);font-size:10px;color:var(--t3);text-align:center;letter-spacing:.02em}

/* ---- HEADER ---- */
.header{height:52px;display:flex;align-items:center;padding:0 20px;border-bottom:1px solid var(--border);background:rgba(10,10,10,.85);backdrop-filter:blur(16px);flex-shrink:0;gap:10px}
.hamburger{display:none;border:none;background:none;color:var(--t2);cursor:pointer;padding:4px;border-radius:6px}
.hamburger:hover{background:var(--surface2)}
.hamburger svg{width:18px;height:18px}
.h-title{font-size:13px;font-weight:500;color:var(--t2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.h-badge{font-size:10px;font-weight:500;padding:3px 8px;border-radius:20px;letter-spacing:.01em;color:var(--t2);background:var(--surface2);border:1px solid var(--border)}

/* ---- MESSAGES ---- */
.messages{flex:1;overflow-y:auto;scroll-behavior:smooth}
.messages::-webkit-scrollbar{width:5px}
.messages::-webkit-scrollbar-thumb{background:var(--t3);border-radius:3px}
.m-inner{max-width:680px;margin:0 auto;padding:32px 24px 12px}

/* welcome */
.welcome{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center;animation:fadeIn .3s ease}
.w-icon{width:48px;height:48px;border-radius:12px;background:var(--surface2);border:1px solid var(--border);display:grid;place-items:center;margin-bottom:28px}
.w-icon svg{width:22px;height:22px;color:var(--t2)}
.welcome h1{font-size:28px;font-weight:600;letter-spacing:-.03em;line-height:1.15;margin-bottom:10px;color:var(--t1)}
.welcome p{font-size:15px;color:var(--t2);max-width:380px;line-height:1.6;font-weight:400}
.w-chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:36px;max-width:480px}
.w-chip{font-size:13px;color:var(--t2);padding:10px 18px;border-radius:8px;border:1px solid var(--border);background:transparent;cursor:pointer;font-family:inherit;transition:all .15s;font-weight:450}
.w-chip:hover{border-color:var(--border-h);color:var(--t1)}

/* msgs */
.msg{margin-bottom:28px;animation:fadeUp .2s ease}
.msg.user{display:flex;justify-content:flex-end}
.msg.user .bubble{background:var(--surface2);border-radius:var(--radius) var(--radius) 4px var(--radius);padding:12px 16px;max-width:65%;font-size:15px;line-height:1.6;color:var(--t1)}
.msg.ai{display:flex;gap:12px}
.ai-ava{width:24px;height:24px;border-radius:6px;display:grid;place-items:center;flex-shrink:0;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;margin-top:2px}
.ai-ava.claude{background:var(--surface2);color:var(--claude);border:1px solid var(--border)}
.ai-ava.chatgpt{background:var(--surface2);color:var(--gpt);border:1px solid var(--border)}
.ai-ava.gemini{background:var(--surface2);color:var(--gemini);border:1px solid var(--border)}
.ai-body{flex:1;min-width:0}
.ai-head{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.ai-name{font-size:12px;font-weight:600;color:var(--t1)}
.ai-cat{font-size:10px;color:var(--t3);background:var(--surface2);padding:2px 7px;border-radius:20px;font-weight:500}
.ai-text{font-size:15px;line-height:1.75;color:var(--t1)}
.ai-text code{font-family:'JetBrains Mono',monospace;font-size:12.5px;background:rgba(255,255,255,.06);padding:2px 5px;border-radius:4px;color:var(--t1)}
.ai-text pre{margin:12px 0;background:rgba(0,0,0,.35);border:1px solid var(--border);border-radius:10px;padding:14px 16px;overflow-x:auto;font-family:'JetBrains Mono',monospace;font-size:12px;line-height:1.6}
.ai-text pre code{background:none;padding:0;color:var(--t1)}
.ai-text strong{font-weight:600;color:var(--t1)}
.ai-text em{color:var(--t2)}
.ai-actions{display:flex;gap:4px;margin-top:8px;opacity:0;transition:opacity .15s}
.msg.ai:hover .ai-actions{opacity:1}
.ai-act{border:none;background:none;color:var(--t3);font-size:11px;cursor:pointer;padding:3px 7px;border-radius:6px;display:flex;align-items:center;gap:4px;font-family:inherit;transition:all .12s}
.ai-act:hover{background:var(--surface2);color:var(--t2)}
.ai-act svg{width:12px;height:12px}

/* multi-model tabs */
.multi{margin-bottom:28px;animation:fadeUp .2s ease}
.multi-tabs{display:flex;gap:2px;padding:3px;background:var(--surface);border-radius:10px;border:1px solid var(--border);width:fit-content;margin-bottom:14px}
.multi-tab{font-size:11px;font-weight:600;padding:5px 12px;border-radius:7px;border:none;background:none;cursor:pointer;font-family:inherit;transition:all .1s;color:var(--t3);display:flex;align-items:center;gap:5px}
.multi-tab:hover{color:var(--t2)}
.multi-tab.active{background:var(--surface2);color:var(--t1)}
.multi-tab .star{color:var(--t3);font-size:9px}
.multi-panel{display:none}
.multi-panel.active{display:block}

/* routing indicator — minimal inline */
.routing{padding:16px 0;animation:fadeIn .15s ease}
.r-inner{max-width:680px;margin:0 auto;padding:0 24px}
.r-card{display:flex;align-items:center;gap:10px;padding:0;background:none;border:none;border-radius:0}
.r-spinner{width:14px;height:14px;border:2px solid var(--t3);border-top-color:var(--t2);border-radius:50%;animation:spin .8s linear infinite}
.r-text{font-size:13px;color:var(--t2)}
.r-dots{display:none}

/* typing dots */
.typing{display:flex;gap:4px;padding:6px 0;align-items:center}
.typing .d{width:4px;height:4px;border-radius:50%;background:var(--t3);animation:tbounce 1.2s ease-in-out infinite}
.typing .d:nth-child(2){animation-delay:.2s}
.typing .d:nth-child(3){animation-delay:.4s}

/* ---- INPUT ---- */
.input-bar{padding:10px 24px 18px;background:rgba(10,10,10,.9);backdrop-filter:blur(16px);border-top:1px solid var(--border);flex-shrink:0}
.input-wrap{max-width:680px;margin:0 auto}
.input-box{position:relative;background:var(--surface);border:1px solid var(--border-h);border-radius:var(--radius);transition:border-color .15s}
.input-box:focus-within{border-color:var(--t3)}
.input-box textarea{width:100%;padding:14px 52px 14px 18px;background:none;border:none;color:var(--t1);font-size:14px;font-family:inherit;line-height:1.5;resize:none;outline:none;min-height:48px;max-height:180px}
.input-box textarea::placeholder{color:var(--t3)}
.btn-send{position:absolute;right:10px;bottom:10px;width:32px;height:32px;border-radius:8px;background:var(--t1);border:none;color:var(--bg);cursor:pointer;display:grid;place-items:center;transition:opacity .15s;opacity:.3}
.btn-send.on{opacity:1}
.btn-send.on:hover{opacity:.85}
.btn-send svg{width:15px;height:15px}
.input-hint{text-align:center;margin-top:8px;font-size:10px;color:var(--t3);letter-spacing:.01em}

/* ---- OVERLAY ---- */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:15;backdrop-filter:blur(4px)}
.overlay.on{display:block}

/* ---- ANIMATIONS ---- */
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeUp{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes tbounce{0%,60%,100%{transform:translateY(0);opacity:.3}30%{transform:translateY(-2px);opacity:.7}}

/* ---- RESPONSIVE ---- */
@media(max-width:768px){
  .sidebar{position:fixed;left:0;top:0;bottom:0;transform:translateX(-100%);z-index:30}
  .sidebar.open{transform:translateX(0)}
  .hamburger{display:flex}
  .m-inner,.input-wrap{padding-left:16px;padding-right:16px}
  .msg.user .bubble{max-width:82%}
  .welcome h1{font-size:26px}
  .w-chips{padding:0 8px}
}
@media(max-width:480px){
  .welcome h1{font-size:22px}
  .w-chip{font-size:12px;padding:8px 14px}
}
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar" id="sidebar">
    <div class="sb-head">
      <div class="sb-logo">
        <div class="sb-mark"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
        <div class="sb-wordmark">nexus</div>
      </div>
      <button class="btn-new" id="btnNew" title="New chat"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
    </div>
    <div class="sb-list" id="sbList">
      <div class="sb-label">History</div>
    </div>
    <div class="sb-foot">AI chooses the model &middot; You get the best answer</div>
  </aside>

  <div class="overlay" id="overlay"></div>

  <div class="main">
    <div class="header">
      <button class="hamburger" id="hamburger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
      <div class="h-title" id="hTitle">New chat</div>
      <div id="hBadges" style="display:flex;gap:5px"></div>
    </div>

    <div class="messages" id="messages">
      <div class="m-inner" id="mInner"></div>
    </div>

    <div class="input-bar">
      <div class="input-wrap">
        <div class="input-box">
          <textarea id="input" placeholder="Just ask. Nexus picks the best AI." rows="1"></textarea>
          <button class="btn-send" id="btnSend"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
        </div>
        <div class="input-hint">Routes to Claude, ChatGPT, or Gemini automatically</div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
'use strict';

const $=s=>document.querySelector(s);
const sidebar=$('#sidebar'),overlay=$('#overlay'),sbList=$('#sbList'),hTitle=$('#hTitle'),hBadges=$('#hBadges');
const messagesEl=$('#messages'),mInner=$('#mInner'),input=$('#input'),btnSend=$('#btnSend');

let convos=JSON.parse(localStorage.getItem('nexus_c')||'[]');
let activeId=null,busy=false;

const M={
  claude:{name:'Claude',abbr:'C',cls:'claude'},
  chatgpt:{name:'ChatGPT',abbr:'G',cls:'chatgpt'},
  gemini:{name:'Gemini',abbr:'Gm',cls:'gemini'}
};

// ---- CLASSIFIER ----
const CAT={
  coding:{kw:['code','function','bug','debug','regex','api','sql','python','javascript','typescript','react','css','html','algorithm','programming','compile','runtime','syntax','class','method','variable','loop','array','git','deploy','server','database','query','endpoint','refactor','test','component','framework','library','npm','docker','script','terminal','bash','rust','golang','swift','kotlin'],model:'claude',label:'Code'},
  image:{kw:['generate image','draw','create picture','design','illustration','sketch','render','visual','art','painting','graphic','logo','mockup','wireframe','ui design','create an image','make an image','picture of'],model:'gemini',label:'Visual'},
  research:{kw:['explain','what is','history of','compare','analyze','define','difference between','how does','why does','overview','summary','research','study','who invented','when was','statistics','trend'],model:'chatgpt',label:'Research'},
  creative:{kw:['write a story','poem','script','creative','brainstorm','fiction','narrative','dialogue','plot','novel','song lyrics','screenplay','blog post','article','essay','rewrite','improve this writing'],model:'claude',label:'Creative'},
  math:{kw:['calculate','solve','equation','proof','probability','integral','derivative','matrix','math','formula','geometry','algebra','calculus','theorem','compute','optimization'],model:'chatgpt',label:'Math'},
  multi:{kw:['compare answers','ask all','get opinions','all models','every model','each model','side by side','compare models','which ai','best answer'],model:'all',label:'Multi-Model'}
};

function classify(text){
  const l=text.toLowerCase();
  let best=null,bestS=0;
  for(const[k,v]of Object.entries(CAT)){
    let s=0;
    for(const w of v.kw) if(l.includes(w)) s+=w.split(' ').length;
    if(s>bestS){bestS=s;best=k}
  }
  return best||(l.includes('?')?'research':'creative');
}

function route(text){
  const cat=classify(text);
  const def=CAT[cat];
  if(def.model==='all') return{models:['claude','chatgpt','gemini'],cat,rec:'claude'};
  return{models:[def.model],cat,rec:def.model};
}

// ---- MOCK RESPONSES ----
const R={
claude:{
coding:[
`Here's a clean approach:

\`\`\`python
def solve(data):
    parsed = parse_input(data)
    validated = validate(parsed)
    return transform(validated)
\`\`\`

Each function has a single responsibility — easy to test and debug individually. The pipeline pattern keeps the data flow explicit.

The key insight: separate *what* you're doing from *how*. Parse first, validate second, transform last. Never mix concerns.`,
`The issue is likely in state management. Here's the fix:

\`\`\`javascript
const state = new Map();
function update(key, val) {
  if (state.get(key) === val) return;
  state.set(key, val);
  queueMicrotask(render);
}
\`\`\`

This batches updates and skips redundant re-renders. \`queueMicrotask\` ensures we only paint once per tick.`
],
creative:[
`The lighthouse keeper hadn't spoken to anyone in forty-three days. Not because there was no one to speak to — the radio crackled with coastal traffic every evening — but because silence had become a language he was finally fluent in.

He tracked time by the rhythm of the lamp: twelve seconds of light, twelve seconds of dark. A mechanical heartbeat for a building that had outlived its purpose.

*He hadn't.*

---

I focused on the tension between isolation and connection. The rhythm motif mirrors both the lighthouse and the keeper's internal state.`,
`Three directions, ranked by impact:

**Minimalist** — Strip to essentials. White space does the heavy lifting. This works when the core idea is strong enough to stand alone.

**Layered** — Interwoven threads that converge. Higher effort, richer payoff.

**Subversive** — Break the conventions deliberately. Risky but memorable.

My instinct: Minimalist. Simplicity has the most impact here.`
],
research:[`**Core Concept:** This involves the interaction between multiple complex systems.

1. **Historical context** — Emerged from 1960s-70s work, building on earlier theory
2. **Current state** — Modern implementations converge on a few dominant approaches
3. **Key tradeoff** — Performance vs. interpretability. Always.

The nuance most people miss: theoretical ideal and practical implementation diverge *significantly*. Real-world apps use approximations that work well enough for specific cases.`],
math:[`Working through this systematically:

\`\`\`
Step 1: f(x) = ax² + bx + c
Step 2: x = (-b ± √(b²-4ac)) / 2a
Step 3: Simplify...
\`\`\`

The solution has a clean closed form. The key insight is recognizing the underlying symmetry — once you see that, the path becomes clear.`],
image:[`I'd approach the design conceptually:

**Direction:** Rule of thirds composition. Muted earth tones with one saturated accent. Golden hour lighting — warm highlights, cool shadows.

For generation, Gemini is the better tool. But I can write optimized prompts that produce significantly better results.`]
},
chatgpt:{
research:[
`Great question. Here's the current understanding:

**Key findings** — 2023-2024 studies show significant progress. The consensus is shifting toward a more nuanced framework.

**Historical context** — The field started mid-20th century. Early models were crude but foundational.

**Current consensus** — Interaction effects matter more than any single factor. Recent meta-analyses show a moderate but robust effect size.

**Bottom line** — Focus on controllable variables. Accept uncertainty in outcomes. A few key factors drive most of the variance.`,
`| Factor | Option A | Option B | Option C |
|--------|----------|----------|----------|
| Speed | High | Medium | Very High |
| Cost | Low | Medium | High |
| Ease | Medium | High | Low |

**Option A** wins on value. **Option B** is most accessible. **Option C** is the power user choice.

The trend is toward C's approach, but A remains the pragmatic pick for most use cases today.`
],
math:[`Solving step by step:

1. Variables and constraints: let x be the primary variable, x > 0
2. Taking the derivative:
   \`f'(x) = 2ax + b = 0 → x* = -b/(2a)\`
3. Second derivative test: \`f''(x) = 2a > 0 ✓\`

**Answer:** x* = -b/(2a)

Global minimum confirmed — the function is convex. Geometrically, it's the vertex of the parabola.`],
coding:[`Here's my approach:

\`\`\`python
def process_data(items, filter_key=None):
    results = []
    for item in items:
        if filter_key and filter_key not in item:
            continue
        processed = {
            'id': item.get('id'),
            'value': item.get('value', 0) * 1.1,
            'status': 'active'
        }
        results.append(processed)
    return sorted(results, key=lambda x: x['value'], reverse=True)
\`\`\`

The optional filter keeps it flexible without complexity. Sorting the output makes results immediately useful.`],
creative:[`*The last email*

She wrote it seventeen times. Deleted it sixteen.

The seventeenth version was three words: "I understand now."

She stared at the cursor blinking after the period. That period was doing a lot of work — holding back a year of conversations that had slowly shifted from exclamation marks to ellipses to this.

Her finger hovered over Send. The office hummed its fluorescent lullaby.

She pressed it.`],
image:[`For image generation, structure your prompt like this:

\`[Subject], [style], [lighting], [mood], [details], [camera angle]\`

**Example:** "A serene mountain lake at dawn, photorealistic, golden hour lighting, peaceful, morning mist, wide-angle, 8K"

Gemini would be the ideal model for actually rendering this.`]
},
gemini:{
image:[
`Here's the art direction:

**Composition:** Centered subject, atmospheric depth. Foreground at 30% opacity for layering.

**Palette:**
- Primary: #2D3436 deep charcoal
- Accent: #E17055 coral
- Highlight: #FFEAA7 soft gold

**Style:** Clean geometry with organic texture overlay. Subtle grain (ISO 400). Shallow DoF.

Output: 1024x1024 base, upscalable to 4K. The visual balances minimalism with enough detail to feel crafted, not sterile.`,
`Layer-by-layer:

**Background** — Midnight blue → dark purple gradient. Subtle star field.
**Mid-ground** — Semi-transparent neon geometry. Tron meets watercolor.
**Foreground** — Flat style with careful shadow work.
**Effects** — Bloom, chromatic aberration at edges, lens flare (sparingly).

Keywords: Futuristic. Ethereal. Luminous. Precise.`
],
research:[`**Quick answer:** Well-established science, strong consensus, mechanisms still being refined.

**How it works:**
1. Input → raw data enters
2. Processing → recursive transformations (this is the part most explanations miss)
3. Output → refined result with measurable confidence

**State of the art:**
- 94% accuracy on standard benchmarks (2024)
- Multimodal outperforms single-mode by 12-18%
- Compute efficiency frontier shifting rapidly

The practical applications have outpaced theoretical understanding. We know it works — we're still figuring out why some approaches work better.`],
coding:[`Optimized for efficiency:

\`\`\`typescript
async function processInBatches<T, R>(
  items: T[],
  processor: (item: T) => Promise<R>,
  config: { batchSize: number; maxRetries: number }
): Promise<R[]> {
  const results: R[] = [];
  for (let i = 0; i < items.length; i += config.batchSize) {
    const batch = items.slice(i, i + config.batchSize);
    const settled = await Promise.allSettled(
      batch.map(item => processor(item))
    );
    for (const r of settled)
      if (r.status === 'fulfilled') results.push(r.value);
  }
  return results;
}
\`\`\`

\`Promise.allSettled\` over \`Promise.all\` — one failure won't tank the batch. Scales from dozens to millions.`],
creative:[`**Signal // Noise**

We built machines that dream in data,
fed them every word we'd ever typed,
every photo, every search at 3 AM
for "why does everything feel"

and they learned us.

Not the versions we perform —
the curated feeds, the careful captions —
but the version that exists
in the negative space between clicks.

The pause before deleting a draft.
The search query we rephrased
because the first one was too honest.

*They know us by our hesitations.*`],
math:[`Geometric intuition first:

\`\`\`
    ╭─────╮
   ╱       ╲
  ╱    ★    ╲    ← minimum
 ╱           ╲
───────────────
\`\`\`

**Formally:** ∇f(x) = 0 → x* = -A⁻¹b/2

**Verification:** Hessian = 2A, positive definite. Global minimum confirmed.

**Result:** x* ≈ 3.14159 — suspiciously close to π, suggesting a deeper geometric connection.`]
}
};

function mockResponse(model,cat){
  const pool=R[model];
  if(!pool) return "Thinking...";
  let arr=pool[cat];
  if(!arr){const keys=Object.keys(pool);arr=pool[keys[Math.floor(Math.random()*keys.length)]];}
  return arr[Math.floor(Math.random()*arr.length)];
}

// ---- UTILS ----
const sleep=ms=>new Promise(r=>setTimeout(r,ms));
function genId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)}
function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}

function fmt(text){
  let h=esc(text);
  h=h.replace(/```(\w*)\n([\s\S]*?)```/g,(_,l,c)=>'<pre><code>'+c.trim()+'</code></pre>');
  h=h.replace(/`([^`]+)`/g,'<code>$1</code>');
  h=h.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
  h=h.replace(/\*(.+?)\*/g,'<em>$1</em>');
  h=h.replace(/^---$/gm,'<hr style="border:none;border-top:1px solid var(--border);margin:14px 0">');
  h=h.replace(/\n/g,'<br>');
  return h;
}

// ---- CONVERSATION STATE ----
function save(){localStorage.setItem('nexus_c',JSON.stringify(convos))}
function active(){return convos.find(c=>c.id===activeId)}

function newConvo(){
  const c={id:genId(),title:'New chat',msgs:[],ts:Date.now()};
  convos.unshift(c);save();return c;
}

function switchTo(id){activeId=id;render();renderSb();updateH()}

function delConvo(id){
  convos=convos.filter(c=>c.id!==id);save();
  if(activeId===id){activeId=null;render();updateH()}
  renderSb();
}

// ---- RENDER ----
function render(){
  const c=active();
  if(!c||!c.msgs.length){renderWelcome();return}
  let h='';
  for(const m of c.msgs){
    if(m.role==='user'){
      h+=`<div class="msg user"><div class="bubble">${esc(m.content)}</div></div>`;
    }else if(m.multi){
      h+=renderMulti(m);
    }else{
      h+=renderAi(m);
    }
  }
  mInner.innerHTML=h;
  scrollEnd();
  bindTabs();
}

function renderAi(m){
  const md=M[m.model]||M.claude;
  const cat=CAT[m.cat]?.label||'';
  return`<div class="msg ai">
    <div class="ai-ava ${md.cls}">${md.abbr}</div>
    <div class="ai-body">
      <div class="ai-head">
        <span class="ai-name ${md.cls}">${md.name}</span>
        ${cat?`<span class="ai-cat">${cat}</span>`:''}
      </div>
      <div class="ai-text">${fmt(m.content)}</div>
      <div class="ai-actions">
        <button class="ai-act" onclick="navigator.clipboard.writeText(decodeURIComponent('${encodeURIComponent(m.content)}'))"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button>
      </div>
    </div>
  </div>`;
}

function renderMulti(m){
  let tabs='',panels='';
  m.responses.forEach((r,i)=>{
    const md=M[r.model];
    const isRec=r.model===m.rec;
    const first=i===0;
    tabs+=`<button class="multi-tab ${md.cls} ${first?'active':''}" data-t="${r.model}">${md.name}${isRec?' <span class="star">&#9733;</span>':''}</button>`;
    const cat=CAT[m.cat]?.label||'';
    panels+=`<div class="multi-panel ${first?'active':''}" data-p="${r.model}">
      <div class="msg ai">
        <div class="ai-ava ${md.cls}">${md.abbr}</div>
        <div class="ai-body">
          <div class="ai-head"><span class="ai-name ${md.cls}">${md.name}</span>${isRec?`<span class="ai-cat">Best fit</span>`:''} ${cat?`<span class="ai-cat">${cat}</span>`:''}</div>
          <div class="ai-text">${fmt(r.content)}</div>
          <div class="ai-actions"><button class="ai-act" onclick="navigator.clipboard.writeText(decodeURIComponent('${encodeURIComponent(r.content)}'))"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button></div>
        </div>
      </div>
    </div>`;
  });
  return`<div class="multi"><div class="multi-tabs">${tabs}</div>${panels}</div>`;
}

function bindTabs(){
  document.querySelectorAll('.multi-tabs').forEach(tg=>{
    const p=tg.closest('.multi');
    tg.querySelectorAll('.multi-tab').forEach(t=>{
      t.onclick=()=>{
        tg.querySelectorAll('.multi-tab').forEach(x=>x.classList.remove('active'));
        p.querySelectorAll('.multi-panel').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        p.querySelector(`[data-p="${t.dataset.t}"]`).classList.add('active');
      };
    });
  });
}

function renderWelcome(){
  mInner.innerHTML=`
    <div class="welcome">
      <div class="w-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
      </div>
      <h1>One prompt.<br>Best model. Instantly.</h1>
      <p>Stop choosing between AI models. Nexus reads your intent and routes to the right one — Claude, ChatGPT, or Gemini — in milliseconds.</p>
      <div class="w-chips">
        <button class="w-chip" data-s="Write a Python function to find all prime numbers up to n">Write a prime sieve</button>
        <button class="w-chip" data-s="Design a minimal logo for a space exploration startup">Design a logo</button>
        <button class="w-chip" data-s="What is quantum computing and why does it matter?">Quantum computing</button>
        <button class="w-chip" data-s="Compare answers: best framework for a new web app in 2026?">Ask all three</button>
      </div>
    </div>`;
}

function renderSb(){
  let h='<div class="sb-label">History</div>';
  if(!convos.length) h+='<div class="sb-empty">No conversations yet</div>';
  for(const c of convos){
    const on=c.id===activeId;
    const last=c.msgs.filter(m=>m.role==='ai').pop();
    const col=last?`var(--${last.model||'accent'})`:'var(--t3)';
    h+=`<div class="sb-item${on?' active':''}" data-id="${c.id}">
      <div class="dot" style="background:${col}"></div>
      <span class="title">${esc(c.title)}</span>
      <button class="del" data-del="${c.id}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>`;
  }
  sbList.innerHTML=h;
  sbList.querySelectorAll('.sb-item').forEach(el=>{
    el.onclick=e=>{if(e.target.closest('.del'))return;switchTo(el.dataset.id);closeSb()};
  });
  sbList.querySelectorAll('.del').forEach(b=>{
    b.onclick=e=>{e.stopPropagation();delConvo(b.dataset.del)};
  });
}

function updateH(){
  const c=active();
  hTitle.textContent=c?c.title:'New chat';
  if(c&&c.msgs.length){
    const used=new Set();
    c.msgs.forEach(m=>{if(m.model)used.add(m.model);if(m.responses)m.responses.forEach(r=>used.add(r.model))});
    hBadges.innerHTML=[...used].map(m=>`<span class="h-badge ${m}">${M[m]?.name||m}</span>`).join('');
  }else{hBadges.innerHTML='';}
}

function scrollEnd(){requestAnimationFrame(()=>{messagesEl.scrollTop=messagesEl.scrollHeight})}

// ---- ROUTING ANIMATION (minimal) ----
async function showRouting(rt){
  const div=document.createElement('div');
  div.className='routing';
  div.innerHTML=`<div class="r-inner"><div class="r-card">
    <div class="r-spinner"></div>
    <span class="r-text">Thinking\u2026</span>
  </div></div>`;
  mInner.appendChild(div);
  scrollEnd();
  await sleep(600+Math.random()*400);
  div.remove();
}

// ---- STREAMING ----
async function stream(el,text){
  el.innerHTML='';
  let rev='';
  const chunks=[];
  for(let i=0;i<text.length;i+=4)chunks.push(text.slice(i,i+4));
  for(const ch of chunks){
    rev+=ch;
    el.innerHTML=fmt(rev);
    scrollEnd();
    await sleep(12+Math.random()*18);
  }
  el.innerHTML=fmt(text);
  scrollEnd();
}

// ---- SEND ----
async function send(){
  const text=input.value.trim();
  if(!text||busy)return;
  busy=true;
  input.value='';input.style.height='auto';
  btnSend.classList.remove('on');

  if(!activeId){const c=newConvo();activeId=c.id}
  const c=active();
  if(!c.msgs.length)c.title=text.length>45?text.slice(0,42)+'...':text;

  c.msgs.push({role:'user',content:text,ts:Date.now()});
  c.ts=Date.now();save();
  render();renderSb();updateH();

  const rt=route(text);
  await showRouting(rt);

  if(rt.models.length>1){
    await doMulti(c,rt);
  }else{
    await doSingle(c,rt);
  }
  busy=false;
}

async function doSingle(c,rt){
  const model=rt.models[0],md=M[model];
  const resp=mockResponse(model,rt.cat);

  // typing
  const t=document.createElement('div');
  t.className='msg ai';t.id='_typing';
  t.innerHTML=`<div class="ai-ava ${md.cls}">${md.abbr}</div><div class="ai-body"><div class="ai-head"><span class="ai-name ${md.cls}">${md.name}</span></div><div class="typing"><div class="d ${md.cls}"></div><div class="d ${md.cls}"></div><div class="d ${md.cls}"></div></div></div>`;
  mInner.appendChild(t);scrollEnd();
  await sleep(500);

  // replace with streamed
  const cat=CAT[rt.cat]?.label||'';
  t.innerHTML=`<div class="ai-ava ${md.cls}">${md.abbr}</div>
    <div class="ai-body">
      <div class="ai-head"><span class="ai-name ${md.cls}">${md.name}</span>${cat?`<span class="ai-cat">${cat}</span>`:''}</div>
      <div class="ai-text" id="_stream"></div>
      <div class="ai-actions"><button class="ai-act" onclick="navigator.clipboard.writeText(decodeURIComponent('${encodeURIComponent(resp)}'))"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button></div>
    </div>`;
  t.removeAttribute('id');

  await stream($('#_stream'),resp);

  c.msgs.push({role:'ai',model,content:resp,cat:rt.cat,ts:Date.now()});
  c.ts=Date.now();save();renderSb();updateH();
}

async function doMulti(c,rt){
  const resps=rt.models.map(m=>({model:m,content:mockResponse(m,rt.cat)}));

  // typing
  const w=document.createElement('div');w.id='_mtyping';
  w.innerHTML=rt.models.map(m=>{const md=M[m];return`<div class="msg ai" style="margin-bottom:8px"><div class="ai-ava ${md.cls}">${md.abbr}</div><div class="ai-body"><div class="ai-head"><span class="ai-name ${md.cls}">${md.name}</span></div><div class="typing"><div class="d ${md.cls}"></div><div class="d ${md.cls}"></div><div class="d ${md.cls}"></div></div></div></div>`;}).join('');
  mInner.appendChild(w);scrollEnd();
  await sleep(800);
  w.remove();

  c.msgs.push({role:'ai',multi:true,responses:resps,rec:rt.rec,cat:rt.cat,ts:Date.now()});
  c.ts=Date.now();save();
  render();renderSb();updateH();
}

// ---- UI ----
function closeSb(){sidebar.classList.remove('open');overlay.classList.remove('on')}
function openSb(){sidebar.classList.add('open');overlay.classList.add('on')}

input.addEventListener('input',()=>{
  input.style.height='auto';
  input.style.height=Math.min(input.scrollHeight,180)+'px';
  btnSend.classList.toggle('on',input.value.trim().length>0);
});
input.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send()}});
btnSend.addEventListener('click',send);
$('#btnNew').addEventListener('click',()=>{activeId=null;render();renderSb();updateH();closeSb();input.focus()});
$('#hamburger').addEventListener('click',openSb);
overlay.addEventListener('click',closeSb);

document.addEventListener('click',e=>{
  const ch=e.target.closest('.w-chip');
  if(ch){input.value=ch.dataset.s;input.dispatchEvent(new Event('input'));send()}
});

// ---- INIT ----
renderWelcome();renderSb();updateH();input.focus();
})();
</script>
</body>
</html>
